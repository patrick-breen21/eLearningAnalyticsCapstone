var lgWidget={categories:[],portlets:[],showTimer:0,init:function(){var f=this;var g=jQuery("#portal_add_content");f.menu=g;if(g.length){f.portlets=g.find(".lfr-portlet-item");f.categories=g.find(".lfr-content-category");f.categoryContainers=g.find(".lfr-add-content");var e=function(){var a=jQuery(this).attr("id");return Liferay.Util.uncamelize(a).toLowerCase()};var h=jQuery("#layout_configuration_content");h.liveSearch({list:f.portlets,data:e,show:function(){var a=jQuery(this);a.show();jQuery(".portal-add-content").addClass("portal-add-content-change-ui");a.parents(".lfr-content-category").addClass("visible lfr-content-category-change-ui").removeClass("hidden").show();a.parents(".lfr-add-content").addClass("expanded lfr-add-content-change-ui").removeClass("collapsed").show()},hide:function(){var a=jQuery(this);a.hide()}});h.liveSearch({list:f.categoryContainers,data:e,after:function(){if(!this.term){jQuery(".portal-add-content").removeClass("portal-add-content-change-ui");f.categories.addClass("hidden").removeClass("visible lfr-content-category-change-ui").css("display","");f.categoryContainers.addClass("collapsed").removeClass("expanded lfr-add-content-change-ui").css("display","");f.portlets.css("display","");jQuery(".lfr-content-category:first").removeClass("hidden").addClass("visible");jQuery(".lfr-add-content:first").removeClass("collapsed").addClass("expanded")}if(this.term=="*"){f.categories.addClass("visible").removeClass("hidden");f.categoryContainers.addClass("expanded").removeClass("collapsed");f.portlets.show()}},exclude:function(){var a=jQuery(".lfr-content-category",this);var b=a.find("> div:visible").length;return b>0}})}},toggle:function(l,m){var p=this;var o=themeDisplay.getPlid();var i=themeDisplay.getDoAsUserIdEncoded();if(!p.menu){var n=themeDisplay.getPathMain()+"/portal/render_portlet";if(m){var k=250;var j=jQuery("body");p._dialog=Liferay.Popup({width:k,message:'<div class="loading-animation" />',position:[4,33],resizable:false,title:Liferay.Language.get("add-application"),onClose:function(){p.menu=null;j.removeClass("lfr-has-sidebar")}})}else{p._dialog=jQuery("#widgets-content")}jQuery.ajax({url:n,data:{p_l_id:o,p_p_id:l,p_p_state:"exclusive",doAsUserId:i},success:function(a){a=a.replace("lfr-auto-focus","");p._dialog.html(a);p._loadContent();jQuery(".lfr-content-category:first").removeClass("hidden").addClass("visible");jQuery(".lfr-add-content:first").removeClass("collapsed").addClass("expanded")}})}},_addPortlet:function(r,n){var q=this;var v=q._getPortletMetaData(r);if(!v.portletUsed){var x=v.plid;var u=v.portletId;var s=v.instanceable;if(!s){r.addClass("lfr-portlet-used");r.draggable("disable")}var t=jQuery('<div class="loading-animation" />');var y=null;var w=null;if(n){var o=n.item;n.placeHolder=t[0];y=n.onComplete;w=n.beforePortletLoaded;o.after(t);o.remove()}else{if(q._sortColumns){q._sortColumns.filter(":first").prepend(t)}}var z={beforePortletLoaded:w,onComplete:y,plid:x,portletId:u,placeHolder:t};var p=Liferay.Portlet.add(z);q._loadPortletFiles(v)}},_getPortletMetaData:function(m){var l=this;var q=m._LFR_portletMetaData;if(!q){var s=(m.attr("instanceable")=="true");var t=m.attr("plid");var o=m.attr("portletId");var p=m.is(".lfr-portlet-used");var r=(m.attr("headerPortalCssPaths")||"").split(",");var n=(m.attr("headerPortletCssPaths")||"").split(",");var v=(m.attr("footerPortalCssPaths")||"").split(",");var u=(m.attr("footerPortletCssPaths")||"").split(",");q={instanceable:s,plid:t,portletId:o,portletPaths:{footer:u,header:n},portalPaths:{footer:v,header:r},portletUsed:p};m._LFR_portletMetaData=q}return q},_loadContent:function(){var i=this;i.init();Liferay.Util.addInputType();Liferay.bind("closePortlet",i._onPortletClose,i);i._portletItems=i._dialog.find("div.lfr-portlet-item");var m=i._portletItems;m.find("a").click(function(b){var c=jQuery(this);var a=c.parents(".lfr-portlet-item:first");i._addPortlet(a)});var j=i._dialog.parents(".ui-dialog").css("z-index");i._helper=jQuery(Liferay.Template.PORTLET).css("z-index",j+10);i._helper.addClass("ui-proxy generic-portlet not-intersecting");var k="Column";var l="body";if(Liferay.Layout.isFreeForm){l="#column-1";k="FreeForm"}else{if(!i._sortColumns||!i._sortableInstance){i._sortColumns=Liferay.Layout.Columns.sortColumns;i._sortableInstance=i._sortColumns.data("sortable")}var n=i._sortColumns;var h=i._sortableInstance;h.refresh();if(!i._eventsBound){n.bind("sortreceive.sortable",function(d,c){if(c.item.is(".lfr-portlet-item")&&c.sender.is(".lfr-portlet-item")&&!h.dragging){var a=c.item;var b=c.sender;var e={item:a};i._addPortlet(b,e);a.hide()}});n.bind("sortactivate.sortable",function(a){Liferay.Layout.Columns.startDragging();h.refreshPositions(true)});n.bind("sortstart.sortable",function(b,a){if(a.item.is(".lfr-portlet-item")){a.placeholder.css({height:200,width:300})}});i._eventsBound=true}}i._dragOptions={appendTo:l,connectToSortable:".lfr-portlet-column",distance:2,helper:function(b){var c=i._helper.clone();var a=this.getAttribute("title");c.find(".portlet-title").text(a);return c[0]},start:function(b,a){if(i["_on"+k+"DragStart"]){i["_on"+k+"DragStart"](b,a,this)}},drag:function(b,a){if(i["_on"+k+"Drag"]){i["_on"+k+"Drag"](b,a,this)}},stop:function(b,a){if(i["_on"+k+"DragStop"]){i["_on"+k+"DragStop"](b,a,this)}}};m.draggable(i._dragOptions);m.filter(".lfr-portlet-used").draggable("disable");if(Liferay.Browser.isIe()){m.hover(function(){this.className+=" over"},function(){this.className=this.className.replace("over","")})}jQuery(".lfr-add-content > h2").click(function(){var a=jQuery(this).parent();var b=a.find("> .lfr-content-category");jQuery(this).parent().siblings(".lfr-add-content").removeClass("expanded").addClass("collapsed");jQuery(this).parent().siblings(".lfr-add-content").children(".lfr-content-category").removeClass("visible").addClass("hidden");b.toggleClass("hidden").toggleClass("visible");a.toggleClass("collapsed").toggleClass("expanded")})},_loadPortletFiles:function(o){var k=this;var r=o.portalPaths.header;var t=o.portalPaths.footer;var l=o.portletPaths.header;var s=o.portletPaths.footer;var m=jQuery("head");var q=jQuery(document.body);var n=r.concat(l);var p=t.concat(s);jQuery.each(n,function(b,a){m.prepend('<link href="'+this+'" rel="stylesheet" type="text/css" />')});if(Liferay.Browser.isIe()){jQuery("body link").appendTo("head");jQuery("link.lfr-css-file").each(function(a){document.createStyleSheet(this.href)})}jQuery.each(p,function(b,a){q.append('<link href="'+this+'" rel="stylesheet" type="text/css" />')})},_onColumnDragStop:function(e,h,g){var f=this;Liferay.Layout.Columns.stopDragging()},_onFreeFormDragStart:function(e,h,g){var f=this;h.helper.removeClass("not-intersecting")},_onFreeFormDragStop:function(q,m,o){var k=this;var l=jQuery(o);var p=m.helper;var n=m.position;var r={height:m.helper.height(),position:"absolute",width:m.helper.width()};var j={beforePortletLoaded:function(a){a=jQuery(a);a.css(n);a.css(r)},item:p,onComplete:function(a,b){jQuery(a).css(n);Liferay.Layout.FreeForm._moveToTop(a);Liferay.Layout.FreeForm._savePosition(a)}};k._addPortlet(l,j)},_onPortletClose:function(h,j){var g=this;var f=jQuery("#portal_add_content");var i=f.find(".lfr-portlet-item[plid="+j.plid+"][portletId="+j.portletId+"][instanceable=false]");if(i.is(".lfr-portlet-used")){i.removeClass("lfr-portlet-used");i.draggable("enable")}}};var lgLayouts={init:function(){var b=this},toggle:function(i,j){var g=this;var l=themeDisplay.getPlid();var h=themeDisplay.getDoAsUserIdEncoded();if(!g.menu){var k=themeDisplay.getPathMain()+"/layout_configuration/templates";g._dialog=jQuery("#load-layouts");jQuery.ajax({url:k,data:{p_l_id:l,p_p_id:i,p_p_state:"exclusive",doAsUserId:h},success:function(a){g._dialog.html(a);jQuery("#load-layouts table").replaceWith(jQuery("#load-layouts table").html().replace(/<tbody/gi,"<div id='layoutTable'").replace(/<tr/gi,"<div").replace(/<\/tr>/gi,"</div>").replace(/<td/gi,"<span").replace(/<\/td>/gi,"</span>").replace(/<\/tbody/gi,"</div"))}})}},};